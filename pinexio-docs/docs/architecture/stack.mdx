---
title: 'Architecture Blueprint'
description: 'Topologia, componentes e fluxos de sess√£o do Secure-OT-Browser.'
date: 2025-11-12
---

# üìê Arquitetura da Solu√ß√£o

Esta se√ß√£o detalha os componentes de hardware e software e o design da rede.

## 1. Pilha de Tecnologia (Stack)

- **Hypervisor (Host):** Proxmox VE
- **Firewall (VM 1):** pfSense
- **Gateway (VM 2):** Ubuntu Server rodando Kasm Workspaces (Docker)

## 2. Requisitos de Hardware (M√≠nimo para 10 Usu√°rios)

- **CPU:** 8+ Cores (AMD EPYC, Intel Xeon)
- **RAM:** 32 GB DDR4
- **Storage:** 1 TB NVMe SSD (para I/O r√°pido dos cont√™ineres)
- **Rede:** 4 Placas de Rede (NICs) F√≠sicas

## 3. Design da Rede

### Interfaces F√≠sicas (Proxmox)

| Interface | Prop√≥sito | Conectado a |
| :--- | :--- | :--- |
| `eno1` | Ger√™ncia (Proxmox) | Switch de Ger√™ncia |
| `eno2` | WAN (Internet) | Roteador/Modem |
| `eno3` | Rede OT | Switch da Rede OT |
| `eno4` | Rede IT (Corp) | Switch da Rede Corp |

### Redes Virtuais (Proxmox Bridges)

| Bridge | IPs (Exemplo) | VMs Conectadas |
| :--- | :--- | :--- |
| `vmbr0` (WAN) | DHCP (P√∫blico) | `pfSense` (WAN) |
| `vmbr1` (OT) | 10.10.1.0/24 | `pfSense` (OT) |
| `vmbr2` (IT) | 192.168.1.0/24 | `pfSense` (IT) |
| `vmbr3` (DMZ) | 192.168.100.0/24 | `pfSense` (DMZ), `Kasm` |

## 4. Matriz de Regras do Firewall (pfSense)

| De (Origem) | Para (Destino) | Porta | A√ß√£o | Prop√≥sito |
| :--- | :--- | :--- | :--- | :--- |
| **OT** | **DMZ** (IP Kasm) | 443 | **PERMITIR** | Acesso ao portal Kasm |
| **OT** | **QUALQUER** | Todas | **NEGAR** | Isola a rede OT |
| **DMZ** | **OT** | Todas | **NEGAR** | Impede ataque da DMZ |
| **DMZ** | **IT** (AD) | 389/636 | **PERMITIR** | Autentica√ß√£o (Opcional) |
| **DMZ** | **WAN** | 80, 443 | **PERMITIR** | Navega√ß√£o dos cont√™ineres |
| **IT** | **DMZ** (IP Kasm) | 443 | **PERMITIR** | Acesso (opcional) |

## 5. Componentes L√≥gicos

| Camada | Responsabilidade | Observa√ß√µes |
| :--- | :--- | :--- |
| **Acesso OT** | Thin client (RDP/VNC/HTML5) renderizando o streaming do Kasm | Sem instala√ß√£o adicional nas esta√ß√µes OT. |
| **Kasm Controller** | Orquestra√ß√£o de sess√µes, autentica√ß√£o e emiss√£o de tokens Kasm | Autentic√°vel via LDAP/AD (opcional). |
| **Kasm Agent Nodes** | Executam cont√™ineres de sess√£o descart√°veis | Container runtime Docker + GPU opcional. |
| **pfSense** | Politicas de firewall, NAT, DNS forwarder, VPN opcional | Exportado/Importado via `config.xml`. |
| **Proxmox** | Virtualiza√ß√£o, bridges de rede, gerenciamento de storage | Monitorar m√©tricas `pveperf` para tuning. |

## 6. Fluxo de Sess√£o

1. Usu√°rio OT acessa `https://<ip_kasm_dmz>` via navegador local endurecido.
2. Requisi√ß√£o HTTPS atravessa pfSense (regra OT‚ÜíDMZ 443 permitida).
3. Kasm autentica o usu√°rio (local ou AD) e aloca um cont√™iner de sess√£o.
4. Cont√™iner surge na rede DMZ, comunica-se com WAN atrav√©s de pfSense (80/443).
5. Apenas v√≠deo/√°udio comprimidos retornam ao cliente OT; nenhum tr√°fego direto OT‚ÜîInternet.
6. Ao encerrar a sess√£o, o cont√™iner √© destru√≠do e logs s√£o enviados para armazenamento central (opcional).

## 7. Integra√ß√µes e Depend√™ncias

- **AD/LDAP corporativo (opcional):** exposto na rede IT (`vmbr2`) com portas 389/636 abertas.
- **Provedor DNS seguro:** pfSense encaminha DNS para upstream filtrado (ex.: Quad9, Umbrella).
- **Observabilidade:** m√©tricas do Proxmox via `Prometheus exporter` ou `Monitoring` gen√©rico.
- **PKI interna:** certificados para Kasm e pfSense administrados por AC corporativa.

## 8. Escalabilidade e Alta Disponibilidade

- **Sess√µes m√°ximas recomendadas:** 5 por servidor (limite atual). Para ampliar:
  - Adicione n√≥s Proxmox e configure `pve-cluster`.
  - Provisione m√∫ltiplos VMs Kasm e distribua sess√µes (round-robin ou GSLB).
  - Use pfSense em HA (CARP) se a disponibilidade exigir SLA > 99,9%.
- **Storage compartilhado:** considere Ceph ou NFS dedicado para snapshots r√°pidos do Kasm.
- **GPU opcional:** se aplica√ß√µes 3D forem necess√°rias, habilite passthrough para a VM Kasm.

## 9. Seguran√ßa e Conformidade

- **Segmenta√ß√£o r√≠gida:** nenhuma rota direta OT‚ÜîWAN; somente streaming Kasm.
- **Hardening:** aplicar OpenSCAP/Ansible para Ubuntu, refor√ßar pfSense (disable admin WAN).
- **Logging:** encaminhar syslog do pfSense e audit logs do Kasm para SIEM gen√©rico.
- **Atualiza√ß√µes:** Terraform limita mudan√ßas de rede; use Ansible para patch windows.

## 10. Riscos e Mitiga√ß√µes

| Risco | Impacto | Mitiga√ß√£o |
| :--- | :--- | :--- |
| Satura√ß√£o do host Proxmox | Queda de sess√µes cr√≠ticas | Monitorar CPU/RAM, escalar antes de >70% uso m√©dio. |
| Comprometimento do pfSense | Ataque transversal entre zonas | Backups di√°rios + restaura√ß√£o r√°pida `config.xml`. |
| Falha no DNS upstream | Navega√ß√£o indispon√≠vel | Configurar m√∫ltiplos forwarders + fallback local. |
| Lat√™ncia elevada WAN | Experi√™ncia degradada | Ajustar QoS no pfSense e otimizar MTU. |
| Perda de certificados TLS | Usu√°rios sem acesso seguro | Automatizar renova√ß√£o via AC ou scripts ACME. |


